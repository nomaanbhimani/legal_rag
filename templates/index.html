<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>LegalMind Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .sidebar {
            background: #fff;
            height: 100vh;
            border-right: 1px solid #ddd;
            padding: 20px;
            position: fixed;
            width: 300px;
        }

        .main-content {
            margin-left: 320px;
            padding: 20px;
        }

        .metric-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background: white;
            text-align: center;
        }

        .tag {
            background: #e7f3ff;
            color: #007bff;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            margin: 4px;
            display: inline-block;
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <h4>ğŸ§  System Status</h4>
        <p class="text-success">â— API Connected</p>
        <p class="text-success">â— Database Active</p>
        <hr>
        <h5>ğŸ“„ Document Upload</h5>
        <input type="file" id="fileInput" multiple class="form-control mb-2">
        <button onclick="uploadFiles()" class="btn btn-outline-primary w-100">Analyze Documents</button>
        <div class="mt-4">
            <small class="text-muted">ğŸ“Š Total Chunks: <span id="chunkCount">0</span></small>
        </div>
    </div>

    <div class="main-content">
        <h1>ğŸ§  LegalMind Document Analyzer</h1>
        <hr>

        <div class="row">
            <div class="col-md-8">
                <h4>ğŸ’¬ Ask Questions</h4>
                <div class="mb-3">
                    <button onclick="setQuery('What are the key obligations?')"
                        class="btn btn-sm btn-light border">Obligations</button>
                    <button onclick="setQuery('Explain termination clauses')"
                        class="btn btn-sm btn-light border">Termination</button>
                </div>
                <textarea id="userQuestion" class="form-control" rows="3"
                    placeholder="Ask your specific question..."></textarea>
                <button onclick="askQuestion()" class="btn btn-primary mt-2 px-4">Analyze</button>

                <div id="results" class="mt-5" style="display:none;">
                    <h5>ğŸ“‹ Analysis Results</h5>
                    <div class="p-3 bg-white border rounded shadow-sm" id="answerText"></div>

                    <div class="row mt-3">
                        <div class="col-6">
                            <div class="metric-card">
                                <h6>ğŸ¯ Confidence</h6>
                                <h4 id="confVal">0.0</h4>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <h6>ğŸ“„ Sources</h6>
                                <h4 id="sourceVal">0</h4>
                            </div>
                        </div>
                    </div>

                    <h5 class="mt-4">ğŸ“Œ Key Terms</h5>
                    <div id="conceptTags"></div>
                </div>
            </div>

            <div class="col-md-4">
                <h4>ğŸ“Š Sources</h4>
                <div id="sourceAccordion"></div>
            </div>
        </div>
    </div>

    <script>
        async function uploadFiles() {
            let formData = new FormData();
            let files = document.getElementById('fileInput').files;
            for (let i = 0; i < files.length; i++) formData.append('files', files[i]);
            let res = await fetch('/upload', { method: 'POST', body: formData });
            let data = await res.json();
            document.getElementById('chunkCount').innerText = data.count;
            alert("Upload Complete!");
        }

        function setQuery(q) { document.getElementById('userQuestion').value = q; }

        async function askQuestion() {
            let q = document.getElementById('userQuestion').value;
            let res = await fetch('/ask', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question: q }) });
            let data = await res.json();

            document.getElementById('results').style.display = 'block';
            document.getElementById('answerText').innerText = data.answer;
            document.getElementById('confVal').innerText = data.confidence;
            document.getElementById('sourceVal').innerText = data.sources.length;
            document.getElementById('conceptTags').innerHTML = data.concepts.map(c => `<span class="tag">${c}</span>`).join('');

            document.getElementById('sourceAccordion').innerHTML = data.sources.map((s, i) => `
            <div class="card mb-2">
                <div class="card-body p-2">
                    <small><b>${s.file}</b></small><br>
                    <small class="text-muted">${s.text.substring(0, 100)}...</small>
                </div>
            </div>
        `).join('');
        }
    </script>
</body>

</html>